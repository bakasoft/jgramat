@object Query =
  {
    @set(
        {+ <`= & #`|$> }:
        [ "=" @string({ <`& #`|$> })]
    )
    / {+ "&" }
   }
  { "&" }

@object Url =
  ^
  [ @set('scheme': @string({+ <":"> })) ":" ]
  [
    "//"
    [ @set('user_info': @string({+ <"@"> })) "@" ]
    @set('host': @string({+ <`: /` | $> }))
    [ ":" @set('port': @integer({+ `0-9` })) ]
  ]
  @set('path': @string("/" {+ <`? #` | $> }))
  [ "?" @set('query': Query) ]
  [ "#" @set('fragment': @string({<$>})) ]
  $
